webpackJsonp([1],{129:function(e,t,n){"use strict";var a=n(130),i=n(246);var o=function(e){n(244)},s=n(19)(a.a,i.a,!1,o,"data-v-636442a1",null);t.a=s.exports},130:function(e,t,n){"use strict";var a=n(35),i=n.n(a),o=n(245),s=n.n(o);t.a={data:function(){return{phoneNumber:null,captchaPassed:!1,verificationCode:null}},props:["showModal"],components:{Modal:s.a},methods:{closeAction(){this.$emit("update:showModal",!1)},login(){if(this.phoneNumber){let e=this;i.a.auth().signInWithPhoneNumber("+65"+this.phoneNumber,window.recaptchaVerifier).then(function(t){window.confirmationResult=t,e.captchaPassed=!0}).catch(function(e){console.log("SMS not sent"),console.log(e),window.recaptchaVerifier.render().then(function(e){window.recaptchaVerifier.reset(e)})})}else alert("Give your queue a name and provide a phone number!")},verifyCode(){if(this.verificationCode){let e=this;window.confirmationResult.confirm(e.verificationCode).then(function(t){e.closeAction(),e.$emit("loggedIn")}).catch(function(e){console.log("bad verification code?"),console.log(e)})}else alert("Ensure that you have input your verification code")}},computed:{showLoginModal:function(){return this.showModal}},mounted:function(){console.log("mounted home!"),window.recaptchaVerifier=new i.a.auth.RecaptchaVerifier("recaptcha-container",{size:"invisible",callback:function(e){console.log("calling back")}})}}},131:function(e,t,n){"use strict";var a=n(66),i=n.n(a),o=n(46);t.a={data:()=>({name:"",introMessage:"Please take a queue number.",nowServingNumber:null,queueNumber:null,phoneNumber:null,notFound:!1}),methods:{requestNumber(){this.$router.push("getNumber")}},components:{VueSimpleSpinner:i.a},created:function(){let e=this;o.a.database.ref("queue/"+this.$route.params.qid+"/"+this.$route.params.id).once("value",function(t){let n=t.val();n?(e.queueNumber=n.queueNumber,e.phoneNumber=n.phoneNumber,document.title=`QUp! - #${e.queueNumber} in ${e.name}`):e.notFound=!0}),o.a.database.ref("queueInfo/"+this.$route.params.qid).on("value",function(t){let n=t.val();n?(e.nowServingNumber=n.nowServing,e.name=n.name,document.title=`QUp! - #${e.queueNumber} in ${e.name}`):e.notFound=!0})},computed:{waitingTimeMins:function(){if(this.queueNumber&&this.nowServingNumber){return 10*(this.queueNumber-this.nowServingNumber)}}}}},132:function(e,t,n){"use strict";var a=n(66),i=n.n(a),o=n(46),s=n(35),r=n.n(s),u=n(129),l=n(254);const c={userVisibleOnly:!0,applicationServerKey:function(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(t);return Uint8Array.from([...n].map(e=>e.charCodeAt(0)))}("BIE6OmBhaW699gnSv4ZGvZeLGOQhhsACHOrWG0aokeZUudhve7n73lvO25S3ki2XjUl9se0Zc7Ld0LzARK2MW7Q")};t.a={data:()=>({name:"",introMessage:"Please take a queue number.",prompt:void 0,nowServingNumber:void 0,nextNumber:void 0,showModal:!1,loggedIn:!1,user:null,owner:null,avgWait:null,waitingTimeMins:null,queueNumber:null,response:void 0}),methods:{setUserPrompt(){o.a.database.ref("queueInfo/"+this.$route.params.qid+"/prompt").set(this.prompt)},resetQueue(){window.confirm("This will remove everyone in the queue. Proceed?")&&(console.log("proceeding"),o.a.database.ref("queueOrder/"+this.$route.params.qid).set(null),o.a.database.ref("queue/"+this.$route.params.qid).set(null),o.a.database.ref("pushSubscriptions/"+this.$route.params.qid).set(null),o.a.database.ref("queueInfo/"+this.$route.params.qid+"/nowServing").set(null),o.a.database.ref("queueInfo/"+this.$route.params.qid+"/total").set(null))},requestNumber(){function e(e){return(e||0)+1}let t=this;const n=t.prompt?window.prompt(t.prompt):void 0;t.prompt&&!n||o.a.database.ref("queueInfo/"+this.$route.params.qid+"/total").transaction(e,a);async function a(e,a,i){if(e&&console.error(e),a){const{uid:e,phoneNumber:a}=t.user;if("serviceWorker"in window.navigator)try{const{pushManager:t}=await window.navigator.serviceWorker.ready;let n=await t.getSubscription();n||(n=await t.subscribe(c),o.a.database.ref(`pushSubscriptions/${e}`).set(n.toJSON()).catch(e=>console.error(e)))}catch(e){console.error(e)}let s={phoneNumber:a,uid:e,createdAt:r.a.database.ServerValue.TIMESTAMP,queueNumber:i.val()};n&&(s.response=n);let u=o.a.database.ref("queue/"+t.$route.params.qid).push(s).key;o.a.database.ref("queueOrder/"+t.$route.params.qid).transaction(function(e){let t=e?JSON.parse(e):[];return s.firebaseId=u,t.push(s),JSON.stringify(t)})}else console.error("Add to queue faied. Try again.")}},login(){this.loggedIn||(this.showModal=!0)},afterLogin(){console.log("afterLogin")},advanceNumber(){let e=this;o.a.database.ref("queueOrder/"+this.$route.params.qid).once("value",function(t){if(t)if(t.val()){let n=JSON.parse(t.val());if(n.length>0){let t=n.splice(0,1)[0];o.a.database.ref(`queueInfo/${e.$route.params.qid}/nowServing`).transaction(e=>t.queueNumber),o.a.database.ref(`queueOrder/${e.$route.params.qid}`).transaction(function(e){if(e){let n=JSON.parse(e);if(JSON.stringify(n[0])===JSON.stringify(t))return n.splice(0,1),JSON.stringify(n)}})}}else console.log("Error! There shouldn't be no val() for queueOrder");else console.log("Error! There shouldn't be an empty queueOrder")})}},components:{VueSimpleSpinner:i.a,"login-modal":u.a,QueueTable:l.a},created:function(){let e=this;o.a.database.ref("queueInfo/"+this.$route.params.qid).on("value",function(t){let n=t.val();n?(e.name=n.name,e.nowServingNumber=n.nowServing,e.nextNumber=(n.total||0)+1,e.owner=n.owner,e.prompt=n.prompt,document.title=`QUp! - ${e.name}`):(e.nowServingNumber=null,e.nextNumber=1)}),o.a.database.ref("queueOrder/"+this.$route.params.qid).on("value",function(t){if(t){let n=t.val();if(n&&e.user){n=JSON.parse(n);for(let t=0;t<n.length;t++){if(n[t].uid===e.user.uid){e.waitingTimeMins=(e.avgWait||10)*(t+1),e.queueNumber=n[t].queueNumber,e.response=n[t].response;break}}}}}),r.a.auth().onAuthStateChanged(function(t){console.log("auth state changed"),t?(e.loggedIn=!0,e.user=t,console.log("user"),console.log(t)):e.loggedIn=!1})},computed:{isOwner:function(){return!(!this.user||!this.owner)&&this.user.uid===this.owner}}}},133:function(e,t,n){"use strict";var a=n(256),i=n.n(a),o=n(46),s=n(257);t.a={data:()=>({tableData:[]}),props:["qid"],methods:{deleteQueueEntry(e,t){const n=JSON.parse(JSON.stringify(this.tableData)),a=this;o.a.database.ref("queueOrder/"+this.$route.params.qid).transaction(function(t){let i=t?JSON.parse(t):[];if(Object(s.a)(i,n)){const t=i.splice(e,1)[0].firebaseId;return o.a.database.ref("queue/"+a.$route.params.qid+"/"+t).transaction(function(e){return null}),JSON.stringify(i)}})},moveToFront(e,t){this.moveRow(0,e)},moveRow(e,t){const n=JSON.parse(JSON.stringify(this.tableData));o.a.database.ref("queueOrder/"+this.$route.params.qid).transaction(function(a){let i=a?JSON.parse(a):[];if(Object(s.a)(i,n)){const n=i.splice(t,1)[0];return i.splice(e,0,n),JSON.stringify(i)}})}},components:{},created:function(){let e=this;o.a.database.ref("queueOrder/"+this.$route.params.qid).on("value",function(t){t&&t.val()?e.tableData=JSON.parse(t.val()):e.tableData=[]})},mounted:function(){const e=this.$el.querySelector(".el-table__body-wrapper tbody"),t=this;i.a.create(e,{onEnd({newIndex:e,oldIndex:n}){t.moveRow(e,n)}})}}},155:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(7),i=n(157),o=n(161),s=n(260),r=n.n(s),u=n(46),l=n(261),c=n(66),d=n.n(c),v=n(263),m=n.n(v),p=n(338);n.n(p);"serviceWorker"in navigator&&navigator.serviceWorker.register("./push-listener.js").then(function(e){console.log("Registration succeeded. Scope is "+e.scope),e.update()}).catch(function(e){console.log("Registration failed with "+e)}),a.default.use(l.a),a.default.use(r.a),a.default.use(d.a),a.default.use(m.a),a.default.config.productionTip=!1,new a.default({el:"#app",firebase:{queueInfo:u.a.database.ref("queueInfo").orderByChild("createdAt"),queue:u.a.database.ref("queue").orderByChild("createdAt")},router:o.a,template:"<App/>",components:{App:i.a}})},157:function(e,t,n){"use strict";var a=n(89),i=n(160);var o=function(e){n(158)},s=n(19)(a.a,i.a,!1,o,null,null);t.a=s.exports},158:function(e,t){},160:function(e,t,n){"use strict";var a={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[this._m(0),this._v(" "),t("main",[t("router-view")],1)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("header",[t("span",[this._v("QUp!")])])}]};t.a=a},161:function(e,t,n){"use strict";var a=n(7),i=n(162),o=n(163),s=n(248),r=n(251);a.default.use(i.a),t.a=new i.a({routes:[{path:"/",name:"home",component:o.a},{path:"/:qid",name:"queue",component:r.a},{path:"/:qid/status/:id",name:"status",component:s.a}]})},163:function(e,t,n){"use strict";var a=n(90),i=n(247);var o=function(e){n(164)},s=n(19)(a.a,i.a,!1,o,"data-v-444cd085",null);t.a=s.exports},164:function(e,t){},244:function(e,t){},246:function(e,t,n){"use strict";var a={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("modal",{attrs:{showModal:e.showLoginModal,closeAction:e.closeAction}},[n("h1",{attrs:{slot:"header"},slot:"header"},[e._v("Login")]),e._v(" "),n("div",{attrs:{slot:"body",id:"recaptcha-container"},slot:"body"}),e._v(" "),e.captchaPassed?n("div",{attrs:{slot:"body"},slot:"body"},[n("p",[e._v("Please enter the code sent to +65 "+e._s(e.phoneNumber)+".")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.verificationCode,expression:"verificationCode"}],attrs:{placeholder:"Enter 6-Digit Code"},domProps:{value:e.verificationCode},on:{input:function(t){t.target.composing||(e.verificationCode=t.target.value)}}})]):n("div",{staticClass:"form-input",attrs:{slot:"body"},slot:"body"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.phoneNumber,expression:"phoneNumber"}],attrs:{placeholder:"Enter Phone Number"},domProps:{value:e.phoneNumber},on:{input:function(t){t.target.composing||(e.phoneNumber=t.target.value)}}})]),e._v(" "),e.captchaPassed?n("button",{attrs:{slot:"footer"},on:{click:e.verifyCode},slot:"footer"},[e._v("Submit")]):n("button",{attrs:{slot:"footer",id:"createQueueButton"},on:{click:e.login},slot:"footer"},[e._v("Submit")])])],1)},staticRenderFns:[]};t.a=a},247:function(e,t,n){"use strict";var a={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._m(0),e._v(" "),n("h5",[e._v("A Simple Queue System")]),e._v(" "),n("div",{staticClass:"form"},[n("div",{staticClass:"form-inputs"},[n("p"),e._v(" "),n("div",{staticClass:"form-input"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],attrs:{placeholder:"Enter queue name"},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}})]),e._v(" "),n("button",{attrs:{id:"createQueueButton"},on:{click:e.login}},[e._v("Create Queue")])])]),e._v(" "),n("login-modal",{attrs:{"show-modal":e.showModal},on:{"update:showModal":function(t){e.showModal=t},loggedIn:e.createQueue}})],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"head"},[t("h1",[this._v("QUp!")])])}]};t.a=a},248:function(e,t,n){"use strict";var a=n(131),i=n(250);var o=function(e){n(249)},s=n(19)(a.a,i.a,!1,o,"data-v-2e730a59",null);t.a=s.exports},249:function(e,t){},250:function(e,t,n){"use strict";var a={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("div",{staticClass:"head"},[t("h1",[this._v(this._s(this.name))]),this._v(" "),t("h3",[this._v("Queue Status")])]),this._v(" "),this.queueNumber?t("div",{staticClass:"queue-info"},[t("div",{staticClass:"now-serving"},[this._v("\n      Now Serving\n\n      "),t("div",{staticClass:"now-serving-box"},[t("div",{staticClass:"now-serving-number"},[this._v(this._s(this.nowServingNumber||"Nobody"))]),this._v(" "),t("div",{staticClass:"waiting-time"},[this._v("avg waiting time: "+this._s(this.waitingTimeMins)+" mins")])]),this._v(" "),t("div",{staticClass:"next"},[t("div",[this._v("Hi there, your queue number is:")]),this._v(" "),t("h2",[this._v(this._s(this.queueNumber))]),this._v(" "),t("div",{staticClass:"text-container"},[this._v("We'll contact you at "+this._s(this.phoneNumber)+" when you're almost at the front of the queue.")]),this._v(" "),t("div",{staticClass:"text-container"},[this._v("This page will automatically refresh with the latest information.")])])])]):this.notFound?t("div",[this._v("\n    Queue information not found.\n  ")]):t("div",{staticClass:"queue-info-spinner"},[t("vue-simple-spinner",{attrs:{message:"Loading...",size:"large"}})],1)])},staticRenderFns:[]};t.a=a},251:function(e,t,n){"use strict";var a=n(132),i=n(259);var o=function(e){n(252),n(253)},s=n(19)(a.a,i.a,!1,o,"data-v-71159b2e",null);t.a=s.exports},252:function(e,t){},253:function(e,t){},254:function(e,t,n){"use strict";var a=n(133),i=n(258);var o=function(e){n(255)},s=n(19)(a.a,i.a,!1,o,"data-v-a2b5dbdc",null);t.a=s.exports},255:function(e,t){},257:function(e,t,n){"use strict";n.d(t,"a",function(){return a});let a=function(e,t){var n=Object.prototype.toString.call(e);if(n!==Object.prototype.toString.call(t))return!1;if(["[object Array]","[object Object]"].indexOf(n)<0)return!1;var i="[object Array]"===n?e.length:Object.keys(e).length;if(i!==("[object Array]"===n?t.length:Object.keys(t).length))return!1;var o=function(e,t){var n=Object.prototype.toString.call(e);if(["[object Array]","[object Object]"].indexOf(n)>=0){if(!a(e,t))return!1}else{if(n!==Object.prototype.toString.call(t))return!1;if("[object Function]"===n){if(e.toString()!==t.toString())return!1}else if(e!==t)return!1}};if("[object Array]"===n){for(var s=0;s<i;s++)if(!1===o(e[s],t[s]))return!1}else for(var r in e)if(e.hasOwnProperty(r)&&!1===o(e[r],t[r]))return!1;return!0}},258:function(e,t,n){"use strict";var a={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-table",{staticClass:"mobileHide",staticStyle:{width:"100%"},attrs:{"row-key":"queueNumber",data:e.tableData,"empty-text":"No one is in the queue"}},[n("el-table-column",{staticStyle:{width:"100%"},attrs:{label:"Queue No",prop:"queueNumber"}}),e._v(" "),n("el-table-column",{staticStyle:{width:"100%"},attrs:{label:"Phone No",prop:"phoneNumber"}}),e._v(" "),n("el-table-column",{staticStyle:{width:"100%"},attrs:{label:"Remarks",prop:"response"}}),e._v(" "),n("el-table-column",{staticStyle:{width:"100%"},attrs:{label:"Actions"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{staticClass:"action-buttons",attrs:{size:"mini"},on:{click:function(n){e.moveToFront(t.$index,t.row)}}},[e._v("Move to front")]),e._v(" "),n("el-button",{staticClass:"action-buttons",attrs:{size:"mini",type:"danger"},on:{click:function(n){e.deleteQueueEntry(t.$index,t.row)}}},[e._v("Delete")])]}}])})],1),e._v(" "),n("el-table",{staticClass:"mobileShow",staticStyle:{width:"100%"},attrs:{"row-key":"queueNumber",data:e.tableData,"empty-text":"No one is in the queue"}},[n("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{staticClass:"action-buttons",attrs:{size:"mini"},on:{click:function(n){e.moveToFront(t.$index,t.row)}}},[e._v("Move to front")]),e._v(" "),n("el-button",{staticClass:"action-buttons",attrs:{size:"mini",type:"danger"},on:{click:function(t){e.deleteQueueEntry(e.scope.$index,e.scope.row)}}},[e._v("Delete")])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"Queue No",prop:"queueNumber"}}),e._v(" "),n("el-table-column",{attrs:{label:"Phone No",prop:"phoneNumber"}}),e._v(" "),n("el-table-column",{attrs:{label:"Response",prop:"response"}})],1)],1)},staticRenderFns:[]};t.a=a},259:function(e,t,n){"use strict";var a={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.name&&""!==e.name?n("div",{staticClass:"head"},[n("h1",[e._v(e._s(e.name))]),e._v(" "),e.loggedIn&&!e.isOwner?n("div",[e._v(e._s(e.introMessage))]):e.loggedIn&&e.isOwner?n("div",[e._v("Admin Interface")]):e._e()]):e._e(),e._v(" "),e.isOwner?e.loggedIn&&e.isOwner?n("div",[e.nextNumber?n("div",{staticClass:"queue-info"},[n("div",{staticClass:"now-serving"},[e._v("\n        You are currently serving\n\n        "),e.nowServingNumber?n("div",{staticClass:"now-serving-box"},[n("div",{staticClass:"now-serving-number"},[e._v(e._s(e.nowServingNumber))]),e._v(" "),e.waitingTimeMins?n("div",{staticClass:"waiting-time"},[e._v("Approx waiting time: "+e._s(e.waitingTimeMins)+" mins")]):e._e()]):n("div",{staticClass:"now-serving-box"},[e._v("\n          No one in the queue now!\n        ")]),e._v(" "),n("div",{staticClass:"next"},[n("div",[e._v("Next number to be issued")]),e._v(" "),n("h3",[e._v(e._s(e.nextNumber))])]),e._v(" "),n("div",[e.loggedIn?n("div",[n("button",{staticClass:"queue-button",on:{click:e.requestNumber}},[e._v("Add a Walk-in")]),e._v(" "),e.isOwner?n("button",{staticClass:"queue-button",on:{click:e.advanceNumber}},[e._v("Serve next person")]):e._e()]):n("button",{staticClass:"queue-button",on:{click:e.login}},[e._v("Login to enter the queue")])]),e._v(" "),n("div",{attrs:{id:"queue-list"}},[n("queue-table",{attrs:{qid:e.$route.params.qid}})],1)])]):e._e(),e._v(" "),n("div",{staticClass:"admin-buttons"},[n("h3",[e._v("Queue Settings")]),e._v(" "),n("button",{staticClass:"queue-button",on:{click:e.resetQueue}},[e._v("Reset queue")]),e._v(" "),n("div",[n("p",[e._v("Optional: Set a question below to ask your customer for more info (e.g. Describe your problem)")]),e._v(" "),n("el-input",{attrs:{id:"prompt",placeholder:"Set question to ask customer",clearable:""},model:{value:e.prompt,callback:function(t){e.prompt=t},expression:"prompt"}}),e._v(" "),n("button",{staticClass:"queue-button",on:{click:e.setUserPrompt}},[e._v("Set Question")])],1)])]):n("div"):n("div",[e.nextNumber?n("div",{staticClass:"queue-info"},[n("div",{staticClass:"now-serving"},[e._v("\n        Now Serving\n\n        "),e.nowServingNumber?n("div",{staticClass:"now-serving-box"},[n("div",{staticClass:"now-serving-number"},[e._v(e._s(e.nowServingNumber))])]):n("div",{staticClass:"now-serving-box"},[e._v("\n          No one in the queue now!\n        ")]),e._v(" "),e.waitingTimeMins&&e.queueNumber?n("div",[n("div",[e._v("Your queue number")]),e._v(" "),n("h1",[e._v(e._s(e.queueNumber))]),e._v(" "),n("div",{staticClass:"waiting-time"},[e._v("Approx waiting time: "+e._s(e.waitingTimeMins)+" mins")]),e._v(" "),e.response?n("div",[n("div",[e._v(e._s(e.prompt))]),e._v(" "),n("h3",[e._v(e._s(e.response))])]):e._e()]):n("div",{staticClass:"next"},[n("div",[e._v("Next number to be issued")]),e._v(" "),n("h3",[e._v(e._s(e.nextNumber))]),e._v(" "),e.loggedIn?n("div",[n("button",{staticClass:"queue-button",on:{click:e.requestNumber}},[e._v("Join queue")])]):n("button",{staticClass:"queue-button",on:{click:e.login}},[e._v("Login to join queue")])])])]):n("div",{staticClass:"queue-info-spinner"},[n("vue-simple-spinner",{attrs:{message:"Loading...",size:"large"}})],1)]),e._v(" "),n("login-modal",{attrs:{"show-modal":e.showModal},on:{"update:showModal":function(t){e.showModal=t},loggedIn:e.afterLogin}})],1)},staticRenderFns:[]};t.a=a},262:function(e,t){},338:function(e,t){},46:function(e,t,n){"use strict";var a=n(35),i=n.n(a);i.a.initializeApp({apiKey:"AIzaSyCHS3kGwS7VTcpDQ0gwnCMmaq8vntC2oL0",authDomain:"queuenowlah.firebaseapp.com",databaseURL:"https://queuenowlah.firebaseio.com",projectId:"queuenowlah",storageBucket:"queuenowlah.appspot.com",messagingSenderId:"557893739908"}),t.a={database:i.a.database()}},89:function(e,t,n){"use strict";t.a={name:"app"}},90:function(e,t,n){"use strict";var a=n(35),i=n.n(a),o=n(129);t.a={data:()=>({name:"",showModal:!1}),methods:{login(){this.name&&""!==this.name?i.a.auth().currentUser?this.createQueue():this.showModal=!0:alert("Give your queue a name and provide a phone number!")},async createQueue(){if(this.name&&""!==this.name){let e=i.a.auth().currentUser;if(e){let t=this;const n=t.name.replace(/[^\w-]/g,""),a=t.$root.$firebaseRefs.queueInfo.child(n);(await a.once("value")).exists()?window.alert("This queue already exists!"):(a.set({name:t.name,owner:e.uid,createdAt:i.a.database.ServerValue.TIMESTAMP}),t.$router.push({name:"queue",params:{qid:n}}))}else this.showModal=!0}}},components:{"login-modal":o.a}}}},[155]);